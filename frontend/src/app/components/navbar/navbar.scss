@use 'sass:color';
$bp-sm: 480px;
$bp-md: 768px;
$bp-lg: 1024px;

$ease-out: cubic-bezier(.22,.61,.36,1);
$fast: .15s;
$normal: .28s;

$brand-blue-base: #1d4ed8;
$brand-green-base: #059669;
$brand-blue: var(--tui-primary, #{$brand-blue-base});
$brand-green: var(--tui-success, #{$brand-green-base});
$brand-bg: linear-gradient(90deg, $brand-blue, $brand-green);

@mixin elevation($level: 2) {
	@if $level == 1 { box-shadow: 0 1px 2px rgba(0,0,0,.08); }
	@else if $level == 2 { box-shadow: 0 2px 4px rgba(0,0,0,.14); }
	@else if $level == 3 { box-shadow: 0 4px 12px rgba(0,0,0,.18); }
}

@mixin focus-ring {
	outline: 2px solid rgba(255,255,255,.65);
	outline-offset: 2px;
}

.nav {
	position: sticky;
	top: 0;
	inset-inline: 0;
	z-index: 60;
	background: $brand-bg;
	color: #fff;
	@include elevation(2);
	backdrop-filter: saturate(140%) blur(6px);
	-webkit-font-smoothing: antialiased;

	&::before {
		content: "";
		position: absolute;
		inset: 0;
		background: linear-gradient(90deg, rgba(255,255,255,.06), rgba(255,255,255,.04));
		pointer-events: none;
	}

	&__inner {
		position: relative;
		display: flex;
		align-items: center;
		justify-content: space-between;
		max-width: 1180px;
		margin: 0 auto;
		padding: .35rem .85rem;
		min-height: 3.25rem;

		@media (min-width: $bp-md) {
			padding: .5rem 1.25rem;
			min-height: 4rem;
		}
	}

	&__brand {
		display: inline-flex;
		align-items: center;
		gap: .6rem;
		text-decoration: none;
		font-weight: 600;
		letter-spacing: .5px;
		color: #fff;
		isolation: isolate;

		&:focus-visible { @include focus-ring; }

		&--mobile { padding: .25rem 0; }
	}

	&__logo {
		height: 2.15rem;
		width: auto;
		display: block;
		filter: drop-shadow(0 2px 4px rgba(0,0,0,.25));

		@media (min-width: $bp-md) { height: 2.75rem; }
	}

	&__toggle {
		position: relative;
		display: inline-flex;
		align-items: center;
		justify-content: center;
		background: rgba(255,255,255,.12);
		color: #fff;
		border: 0;
		padding: .55rem .6rem;
		border-radius: .75rem;
		cursor: pointer;
		transition: background $fast $ease-out, transform $fast $ease-out;
		@include elevation(1);

		&:hover { background: rgba(255,255,255,.18); }
		&:active { transform: scale(.94); }
		&:focus-visible { @include focus-ring; }

		&--close { padding: .45rem; }

		@media (min-width: $bp-md) {
			display: none;
		}
	}

	&__toggle-icon { width: 1.45rem; height: 1.45rem; }

	&__links {
		list-style: none;
		margin: 0;
		padding: 0;
		display: none;
		gap: 1.35rem;
		align-items: center;
		font-size: .92rem;
		font-weight: 500;
		letter-spacing: .6px;

		@media (min-width: $bp-md) { display: flex; }

		a {
			position: relative;
			display: inline-block;
			padding: .4rem .55rem .55rem;
			text-decoration: none;
			color: #fff;
			border-radius: .35rem;
			transition: color $fast $ease-out, background $fast $ease-out;

			&:link,
			&:visited { color: #fff; text-decoration: none; }

			&:hover { background: rgba(255,255,255,.10); }
			&:focus-visible { @include focus-ring; }

			&.is-active {
				font-weight: 600;
			}

			&::after {
				content: "";
				position: absolute;
				left: 12%; right: 12%; bottom: .3rem;
				height: 2px;
				background: currentColor;
				transform: scaleX(0);
				transform-origin: left;
				transition: transform $normal $ease-out;
				border-radius: 2px;
			}
			&:hover::after { transform: scaleX(1); }
			&.is-active::after { transform: scaleX(1); }
		}
	}
}

/* Desktop grouped dropdowns */
.nav__links--desktop-groups {
	gap: 1rem;
	@media (max-width: $bp-md) { display: none !important; }

	.nav__group {
		position: relative;
		&::before { content:""; position:absolute; left:0; top:100%; width:100%; height:14px; }
		&:hover > .nav__dropdown { opacity:1; transform: translateY(0); pointer-events:auto; }
		&:hover > .nav__group-primary { background: rgba(255,255,255,.10); }
	}

	.nav__group-primary { text-decoration:none; color:#fff; font-weight:600; padding:.55rem .75rem; border-radius:.7rem; display:inline-block; transition: background $fast $ease-out; position:relative; }
	.nav__group-primary.is-active { background: rgba(255,255,255,.18); }

	.nav__dropdown { position:absolute; top:100%; left:0; margin-top:.25rem; transform: translateY(6px); width: 230px; background: rgba(0,0,0,.45); backdrop-filter: blur(10px) saturate(140%); border:1px solid rgba(255,255,255,.18); border-radius: .95rem; padding:.75rem .75rem 1rem; opacity:0; pointer-events:none; transition: opacity $fast $ease-out, transform $fast $ease-out; z-index: 200; @include elevation(2); }
	.nav__dropdown-list { list-style:none; margin:0; padding:0; display:flex; flex-direction:column; gap:.4rem; }
	.nav__dropdown-list a { display:block; background: rgba(255,255,255,.10); color:#fff; text-decoration:none; padding:.55rem .7rem .6rem; border-radius:.65rem; font-size:.78rem; font-weight:500; letter-spacing:.4px; transition: background $fast $ease-out, transform $fast $ease-out; }
	.nav__dropdown-list a:hover { background: rgba(255,255,255,.18); transform: translateX(3px); }
	.nav__dropdown-list a:focus-visible { @include focus-ring; }
	.nav__dropdown-see-all { display:inline-block; margin-top:.6rem; font-size:.6rem; letter-spacing:.45px; text-transform:uppercase; opacity:.85; color:#fff; text-decoration:none; font-weight:600; }
	.nav__dropdown-see-all:hover { opacity:1; text-decoration:underline; }
	.nav__dropdown-see-all:focus-visible { @include focus-ring; }

	.nav__simple > a { font-weight:600; }
}


.nav-mobile {
	position: fixed;
	top: 0; left: 0; right: 0; bottom: 0;
	width: 100vw;
	height: 100vh;
	z-index: 120;
	display: flex;
	flex-direction: column;
	background: linear-gradient(180deg, $brand-blue 0%, $brand-green 90%);
	background-attachment: fixed;
	padding: 1rem 1rem 2rem;
	animation: slideDown $normal $ease-out;
	overflow-y: auto;
	font-size: 1rem;
	color: #fff;
	-webkit-overflow-scrolling: touch;

	@media (min-width: $bp-md) { display: none; }

	&__backdrop { display: none; }

	&__panel {
		flex: 1;
		display: flex;
		flex-direction: column;
		width: 100%;
	}

	&__header {
		display: flex;
		align-items: center;
		justify-content: space-between;
		margin-bottom: .75rem;
		padding-bottom: .35rem;
		border-bottom: 1px solid rgba(255,255,255,.18);
	}

	&__links {
		list-style: none;
		margin: 0;
		padding: .75rem 0 0;
		display: flex;
		flex-direction: column;
		gap: .55rem;
		font-size: 1.05rem;

		a {
			display: block;
			padding: .9rem 1rem .95rem;
			border-radius: .8rem;
			color: #fff;
			font-weight: 500;
			text-decoration: none;
			background: rgba(255,255,255,.12);
			transition: background $fast $ease-out, transform $fast $ease-out;
			&:link,
			&:visited { color: #fff; text-decoration: none; }

			&:hover { background: rgba(255,255,255,.20); transform: translateX(4px); }
			&:active { transform: translateX(2px) scale(.97); }
			&:focus-visible { @include focus-ring; }
			&.is-active { background: rgba(255,255,255,.28); font-weight: 600; }
		}
	}
}

/* Taiga accordion dentro do mobile */
.mobile-accordion {
	display: flex;
	flex-direction: column;
	gap: .5rem;
	margin-top: .25rem;

	&__item { background: rgba(255,255,255,.12); border: 1px solid rgba(255,255,255,.15); border-radius: .9rem; overflow: hidden; }

	&__primary {
		appearance: none;
		background: transparent;
		border: 0;
		color: #fff;
		text-align: left;
		width: 100%;
		padding: .95rem 1rem .95rem 1.05rem;
		display: flex;
		align-items: center;
		justify-content: space-between;
		gap: .75rem;
		font-size: .95rem;
		font-weight: 600;
		letter-spacing: .5px;
		cursor: pointer;
		transition: background $fast $ease-out;
		text-decoration: none;
		&:hover { background: rgba(255,255,255,.10); }
	}

	.chevron { width: .65rem; height: .65rem; border-right: 2px solid currentColor; border-bottom: 2px solid currentColor; transform: rotate(45deg); transition: transform $fast $ease-out; }
	.chevron--open { transform: rotate(225deg); }

	&__panel { animation: contentIn .3s ease; padding: .35rem .85rem 1rem 1.2rem; background: rgba(0,0,0,.25); border-top: 1px solid rgba(255,255,255,.1); }
	&__see-all {
		display: inline-block; margin-top: .4rem; font-size: .7rem; letter-spacing: .5px; text-transform: uppercase; opacity: .8;
		color:#fff; text-decoration:none; font-weight:600;
		&:link,&:visited { color:#fff; text-decoration:none; }
		&:hover { opacity:1; text-decoration:underline; }
		&:focus-visible { @include focus-ring; }
	}
}

.mobile-sub {
	list-style: none; margin: 0; padding: 0; display: flex; flex-direction: column; gap: .25rem;
	li a {
		font-weight: 400;
		font-size: .82rem;
		padding: .45rem .55rem;
		border-radius: .55rem;
		background: rgba(255,255,255,.08);
		display: block;
		color: #fff;
		text-decoration: none;
		transition: background $fast $ease-out, transform $fast $ease-out;
		&:link,&:visited { color:#fff; text-decoration:none; }
		&:hover { background: rgba(255,255,255,.18); transform: translateX(3px); }
		&:active { transform: translateX(1px) scale(.97); }
		&:focus-visible { @include focus-ring; }
	}
}

.mobile-social { margin-top: 1rem; padding: .75rem .25rem; }
.mobile-social a { display: inline-flex; padding: .65rem 1rem; background: rgba(255,255,255,.18); border-radius: .7rem; font-size: .85rem; text-decoration: none; color: #fff; }

body.no-scroll { overflow: hidden; }

.visually-hidden {
	position: absolute !important;
	width: 1px; height: 1px;
	padding: 0; margin: -1px;
	overflow: hidden; clip: rect(0 0 0 0);
	white-space: nowrap; border: 0;
}

@keyframes slideDown {
	0% { opacity: 0; transform: translateY(-12px); }
	100% { opacity: 1; transform: translateY(0); }
}
@keyframes fadeIn {
	0% { opacity: 0; }
	100% { opacity: 1; }
}

@media (prefers-color-scheme: dark) {
    .nav {
        backdrop-filter: blur(8px) brightness(.95);
    }
    .nav-mobile__panel {
        background: linear-gradient(
            180deg,
            color-mix(in srgb, #{$brand-blue-base} 90%, #000) 0%,
            color-mix(in srgb, #{$brand-green-base} 85%, #000) 90%
        );

		@supports not (background: color-mix(in srgb, red, blue)) {
			background: linear-gradient(
				180deg,
				#{color.adjust($brand-blue-base, $lightness: -5%)} 0%,
				#{color.adjust($brand-green-base, $lightness: -5%)} 90%
			);
		}
    }
}

